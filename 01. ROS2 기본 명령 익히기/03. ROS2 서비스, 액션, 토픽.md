뭔가 많다! 그래서 한큐에 정리를 해보려 한다.

먼저 용어 정리!

1. 동기적(Synchronous)  - 어떤 작업을 요청했을 때 그 작업이 종료될때 까지 기다린 후 다음 작업을 수행하는 방식

2. 비동기적(Asynchronous)  - 어떤 작업을 요청했을 때 그 작업이 종료될때 까지 기다리지 않고 다른 작업을 하고 있다가, 요청했던 작업이 종료되면 그에 대한 추가 작업을 수행하는 방식

### 1. 서비스 (동기적)
---
가장 기본적인 통신방식이다. 서비스는 클라이언트 노드가 요청을 하면 서버 노드가 응답을 해주는 방식으로 이루어져 있다. 

서비스도 토픽처럼 하나의 채널에 여러 노드가 연결할 수 있지만 토픽이 n:n으로 통신하는 반면 노드는 1:1로 통신한다.


![[27.gif]]

![[28.gif]]

- 동기식 양방향 메시지 송수신 방식
- Service server와 Service client 간의 통신
- Request/Response


### 2. 토픽 (비동기적적)
---
서비스와는 다르다. 서비스는 양쪽에 상호 작용이 있어야 한다 (요청과 응답). 하지만 토픽은 오로지 단방향으로 이루어진다. 

서비스는 한쪽이 요청하면 다른 한쪽이 반드시 응답을 해줘야 한다. 하지만 토픽은 한쪽이 요청할뿐 다른 한쪽이 반드시 응답을 해야하는 이유가 없다. 

예를 들어 유튜브 구독을 생각해보자. 크리에이터는 동영상을 만들고 구독자들에게 영상을 전달한다. 하지만 크리에이터가 구독자한테 영상을 봤다는 메시지를 받을 필요는 없다. 그저 자신의 구독자들에게만 영상을 전달하고 구독자는 구독이 되어있다면 언제든 그 영상을 받을 수 있다. (원치 않는다면 구독 취소를 하면 된다.)

이러한 구독 방식이 적용되는것이다. 

Topic 메시지 통신은 정보를 보내는 Publisher Node와 정보를 받는 Subscriber Node가 Topic 메시지 형태로 정보를 송수신하는 것이다. Topic은 Node간의 메시지 통신으로 다른 시스템(Subscriber Node)에 데이터를 지속적으로 보낼 수 있다.

![](https://244752272-files.gitbook.io/~/files/v0/b/gitbook-legacy-files/o/assets%2F-LyHRC9e7QHR_6zOcflF%2F-M5RnapHvKE0E5Fl39WI%2F-M5S81ifOTmRK7EcwX81%2Fimage.png?alt=media&token=e10b1d25-f5e5-43b8-ac33-70fc83334870)

- 비동기식 단방향 메시지 송수신 방식
- Publisher와 Subscriber 간의 통신
- 1:N, N:1, N:N 통신도 가능
- 통신을 중단하기 전까지 연속적으로 메시지를 보내는 것


### 3. 액션 (동기적)
---
![[29.gif]]

서비스와 유사하지만 서비스의 동기적으로 작용한다는 부분을 보완한 방식이다. 

하지만 단순하게 비동기적으로 작동할거였다면 토픽을 사용했을 것이다. 토픽이 가진 문제점이 상대가 구독을 했다면 어떤 상태인지 무시하고 그냥 무작정 메시지(명령어)를 발행한다는 것이다. 

반면 액션은 먼저 목표(goal)를 서비스를 통해 설정한다. 액션 서버는 결과(result)가 있을때까지 피드백(feedback)을 토픽을 통해 발행(publish) 한다.

즉, 클라이언트 노드가 요청하면 서버 노드가 응답을 해준다. 이때 클라이언트 노드는 결과값을 받는데 결과값이 오기 전까지 중간 과정들(피드백)을 받을 수 있는 것이다.


![[30.png]]

액션은 토픽의 비동기 통신과 서비스의 동기통신이 혼합되어 있으므로 액션을 원활히 수행하기 위해 따로 상태 머신(state machine)을 운용한다.

클라이언트로 부터 목표 서비스 요청을 받으면 상태머신을 통해 액션 목표의 상태에 이르기까지 토픽을 통해 피드백을 보낸다.


### 4. 한눈에 본다면 이런 느낌이다.
---
![[31.png]]



# 참고 문헌
---
> https://www.robotstory.co.kr/king/?board_name=king_bbs&search_field=fn_title&search_text=%EC%84%9C%EB%B9%84%EC%8A%A4&vid=878

>https://robertchoi.gitbook.io/ros2/02-ros2